{% extends "base.html" %}
{% block title %} Attendance {% endblock %}

{% block content %}

<header>
    <h2 id="pageTitle">Attendance Records</h2>
    <div class="controls">
        <input id="search" name="search" placeholder="üîç Search student..." 
               value="{{ request.args.get('search','') }}" 
               style="min-width:220px">

        <select  id="statusFilter" name="status">
            <option style="color: black;" value="">All Status</option>
            <option style="color: black;" value="Present" {% if request.args.get('status')=='Present' %}selected{% endif %}>Present</option>
            <option style="color: black;"  value="Absent" {% if request.args.get('status')=='Absent' %}selected{% endif %}>Absent</option>
        </select>

        <input type="date" id="dateFilter" name="date" value="{{ request.args.get('date','') }}">

        <button class="btn" onclick="applyFilters()">Apply</button>
    </div>
</header>

<script>
function applyFilters() {
    const s = document.getElementById('search').value;
    const st = document.getElementById('statusFilter').value;
    const d = document.getElementById('dateFilter').value;
    window.location = `?search=${s}&status=${st}&date=${d}`;
}
</script>

{% if attendances and attendances.items|length > 0 %}

<div class="card">
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Student</th>
                    <th>Status</th>
                    <th>Time</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                {% for a in attendances.items %}
                <tr>
                    <td>{{ a.id }}</td>
                    <td>{{ a.student.name }}</td>

                    <td>
                        {% if a.status == 'Present' %}
                        <span class="badge badge-success">Present</span>
                        {% else %}
                        <span class="badge badge-danger">Absent</span>
                        {% endif %}
                    </td>

                    <td>{{ a.timestamp }}</td>

                    <td>
                        <div class="table-actions">
                            <button class="action-btn delete"
                                onclick="if(confirm('Delete record?')) window.location='{{ url_for('dashboard.delete_attendance', id=a.id) }}'">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div style="margin-top:20px; text-align:center;">
        {% if attendances.has_prev %}
        <a href="{{ url_for('dashboard.attendance', page=attendance.prev_num) }}" class="btn ghost">‚¨Ö Prev</a>
        {% endif %}

        <span style="margin:0 10px;">Page {{ attendances.page }} of {{ attendances.pages }}</span>

        {% if attendances.has_next %}
        <a href="{{ url_for('dashboard.attendance', page=attendance.next_num) }}" class="btn ghost">Next ‚û°</a>
        {% endif %}
    </div>

</div>

{% else %}
<div class="card" style="padding:40px; text-align:center;">
    <div style="font-size:48px; opacity:0.6;">üì≠</div>
    <h3>No Attendance Records Found</h3>
    <p class="small">Try changing filters or add new entries.</p>
</div>
{% endif %}

{% endblock %}
